Poolpool
===

Это менеджер poolboy`ев.
Сделан по аналогии с nginx upstream.

  http://nginx.org/ru/docs/http/ngx_http_upstream_module.html

Создается для того, чтобы быстро управлять пулами из коннектов к riak.
Смысл в том, что если какая-либо нода riak`а падает, то мы должны быстро выкинуть
её из оборота, переодически мониторить и потом вернуть в строй.

Inside
---

Внутри poolpool есть три очереди:

* active
* down
* backup

Когда приходит запрос на ресурс, poolpool достает из очереди active 
одного poolboy`я; если очередь active пуста, то достаём из очереди 
backup; если и эта очередь пуста, то возвращаем ошибку {error, no_workers}.

Далее посылается запрос на ресурс этому poolboy`ю. Если он отдаёт, 
то ответ отдаётся выше, если не отдаёт, то помечаем этого poolboy`я как
битого и просим выдать другого.

Клиент poolpool`а может просто возвратить соединение в общий пул, а может
возвратить как битое. Во втором случае весь poolboy переходит из active
в down.

Преполагается, что работа с очередями будет проходить внутри gen_server`а,
работа с ets-таблицей, хранящей отображение {WorkerPid, PoolboyPid}, будет
проходить в процессе клиента (таблицы будут не private).

Переодически будут проходить валидации из очереди down. Для валидации
ресурс должен предоставать специальную функцию
(behaviour(poolpool_worker)).


vim: ts=4 sw=4 et

